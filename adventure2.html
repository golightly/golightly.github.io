<html>
<head>
<link rel="stylesheet" href=".\style.css">
<title>adventure</title>
</head>
<body>
<div id="stats">
	<p id="pointsAvailable">Points Available: 5</p>
	<span id="strength">Strength: 1</span>
	<button type="button" value="str" onclick="incrementStr()">&gt</button> <br>
	<span id="constitution">Constitution: 1</span>
	<button type="button" value="con" onclick="incrementCon()">&gt</button> <br>
	<span id="agility">Agility: 1</span>
	<button type="button" value="agi" onclick="incrementAgi()">&gt</button> <br>
	<span id="accuracy">Accuracy: 1</span>
	<button type="button" value="acc" onclick="incrementAcc()">&gt</button> <br>
	<span id="speed">Speed: 1</span>
	<button type="button" value="spd" onclick="incrementSpd()">&gt</button> <br>
	<span id="luck">Luck: 1</span>
	<button type="button" value="lck" onclick="incrementLck()">&gt</button> <br>
	<div id="notification">
		<p id="adText">Click below for an exp boost</p>
	</div>
	<div id="displayArea">
		<img src="https://i.imgur.com/rcz86tZ.png" alt="couldn't be displayed">
	</div>
</div>
<div id = "charData">
	<p id="charName">Name: test</p>
	<p id = "charLevel">Level: 1</p>
	<p id = "charGold">Gold: 0</p>
	<p id="hitPoints">Hit Points: 5</p>
	<p id="playerExp">Experience Points: 0</p>
	<p id="floorNum">Floor Number: 1</p>
</div>
<div id="mainArea">
	<p id="text">time remaining: 30</p>
</div>

<script>
var myName = location.search.split("=")[1];
document.getElementById("charName").innerHTML = "Name: " + myName;
var str = 1;
var con = 1;
var agi = 1;
var acc = 1;
var spd = 1;
var lck = 1;
var gold = 0;
var level = 1;
var floor = 1;
var exp = 0;
var hp = con * 5;
var maxHp = hp;
var enemyStr = 0;
enemyCon = 0;
var enemyAgi = 0;
var enemyAcc = 0;
var enemySpd = 0;
var enemyLck = 0;
var enemyGold = 0;
var enemyExp = 0;
var enemyHp = enemyCon * 5;
var enemyPoints = 0;
var pointsVar = 5;
var initiative = 0;
var numAttacks = 0;
var gameOver = false;
var healTime = 50;
var floorTime = 600;
var numRounds = 2;
function incrementStr() {
	console.log("function activated!");
	console.log(pointsVar);
	if(pointsVar > 0) {
		console.log("inner function activated!");
		str += 1;
		console.log(str);
		document.getElementById("strength").innerHTML = "Strength: " + str;
		pointsVar -= 1;
		document.getElementById("pointsAvailable").innerHTML = "Points Available: " + pointsVar;
	}
}
function incrementCon() {
	if(pointsVar > 0) {
		con += 1;
		maxHp = con * 5;
		document.getElementById("constitution").innerHTML = "Constitution: " + con;
		pointsVar -= 1;
		document.getElementById("pointsAvailable").innerHTML = "Points Available: " + pointsVar;
	}
}
function incrementAgi() {
	if(pointsVar > 0) {
		agi += 1;
		document.getElementById("agility").innerHTML = "Agility: " + agi;
		pointsVar -= 1;
		document.getElementById("pointsAvailable").innerHTML = "Points Available: " + pointsVar;
	}
}
function incrementAcc() {
	if(pointsVar > 0) {
		acc += 1;
		document.getElementById("accuracy").innerHTML = "Accuracy: " + acc;
		pointsVar -= 1;
		document.getElementById("pointsAvailable").innerHTML = "Points Available: " + pointsVar;
	}
}
function incrementSpd() {
	if(pointsVar > 0) {
		spd += 1;
		document.getElementById("speed").innerHTML = "Speed: " + spd;
		pointsVar -= 1;
		document.getElementById("pointsAvailable").innerHTML = "Points Available: " + pointsVar;
	}
}
function incrementLck() {
	if(pointsVar > 0) {
		lck += 1;
		document.getElementById("luck").innerHTML = "Luck: " + lck;
		pointsVar -= 1;
		document.getElementById("pointsAvailable").innerHTML = "Points Available: " + pointsVar;
	}
}
var time = 30;
var phase = 0;
var currentLine = 0;
var lines = new Array(35);
var fullText;
function updateTimer() {
	--time;
	document.getElementById("text").innerHTML = "time remaining: " + time;
	if(time <= 0) {
		clearInterval(timer);
		lines[0] = "time remaining: " + time;
		++currentLine;
		mainFunction();
	}
}
var timer = setInterval(updateTimer, 1000);
function runPhase() {
	if(currentLine == 35) {
		for(var a = 1; a < 35; ++a) {
			lines[a-1] = lines[a];
		}
		--currentLine;
	}
	if(phase == 0) {
		lines[currentLine] = myName + " encounters a goblin!";
		++phase;
		enemyPoints = Math.floor((Math.random() * 6) + 1) * floor;
		enemyStr = 1;
		enemyCon = 1;
		enemyAgi = 1;
		enemyAcc = 1;
		enemySpd = 1;
		enemyLck = 1;
		for(var a = 0; a < enemyPoints; ++a) {
			var randomNum = Math.floor((Math.random() * 6) + 1) * floor;
			if(randomNum == 1) {
				++enemyStr;
			}
			else if(randomNum == 2) {
				++enemyCon;
			}
			else if(randomNum == 3) {
				++enemyAgi;
			}
			else if(randomNum == 4) {
				++enemyAcc;
			}
			else if(randomNum == 5) {
				++enemySpd;
			}
			else {
				++enemyLck;
			}
		}
		enemyHp = enemyCon * 5;
		enemyGold = Math.floor((Math.random() * 5) + 1) * floor;
		enemyExp = Math.floor((Math.random() * 6) + 1) * floor;
		numRounds = 2;
	}
	else if(phase == 1) {
		if(enemySpd > spd) {
			initative = 0;
			numAttacks = 1 + (enemySpd / 10);
		}
		else {
			initative = 1;
			numAttacls = 1 + (spd / 10);
		}
		++phase;
	}
	else if(phase == 2) {
		if(initiative == 0) {
			if(numAttacks >= 0) {
				var toHit = enemyAcc + (Math.floor((Math.random() * 6) + 1) * (enemyAcc/5));
				var toResist = agi + (Math.floor((Math.random() * 6) + 1) * (agi/5));
				if(toHit > toResist) {
					var damage = (Math.floor(Math.random() * 6) + 1) * (enemyStr / 5);
					lines[currentLine] = "goblin deals " + damage + " to " + myName;
					hp -= damage;
					document.getElementById("hitpoints").innerHTML = "Hit Points: " + hp;
				}
				else {
					lines[currentLine] = "goblin misses " + myName;
				}
				--numAttacks;
			}
			else {
				initiative = 1;
				numAttacks = numAttacls = 1 + (spd / 10);
				--numRounds
			}
		}
		else if(initiative == 1) {
			if(numAttacks >= 0) {
				var toHit = acc + (Math.floor((Math.random() * 6) + 1) * (acc/5));
				var toResist = enemyAgi + (Math.floor((Math.random() * 6) + 1) * (enemyAgi/5));
				if(toHit > toResist) {
					var damage = (Math.floor(Math.random() * 6) + 1) * (str / 5);
					lines[currentLine] = myName + " deals " + damage + " to goblin";
					enemyHp -= damage;
				}
				else {
					lines[currentLine] = myName + " misses the goblin";
				}
				--numAttacks;
			}
			else {
				initiative = 0;
				numAttacks = 1 + (enemySpd / 10);
				--numRounds;
			}
		}
		if(numRounds == 0) {
			--phase;
		}
	}						
	--healTime;
	if(enemyHp <= 0) {
		exp += enemyExp;
		document.getElementById("playerExp").innerHTML = "Experience Points: " + exp;
		gold += enemyGold;
		document.getElementById("charGold").innerHTML = "Gold: " + gold;
		lines[currentLine] = myName + " kills goblin";
		phase = 0;
	}
	++currentLine;
	for(var a = 0; a < currentLine; ++a) {
		if(a==0) {
			fullText = lines[a] + "<br>";
		}
		else {
			fullText += (lines[a] + "<br>");
		}
	}
	document.getElementById("text").innerHTML = fullText;
	if(hp <= 0) {
		gameOver = true;
		clearInterval(gameTimer);
		document.getElementById("text").innerHTML = "game over!";
	}
	if(healTime == 0) {
		hp += (Math.floor(Math.random() * 5) + 1) * (con / 5);
		if(hp > maxHp) {
			hp = maxHp;
		}
		healTime = 50;
		document.getElementById("hitpoints").innerHTML = "Hit Points: " + hp;
	}
	if(exp >= (level * 150)) {
		++level;
		document.getElementById("charLevel").innerHTML = "Level: " + level;
		++pointsVar;
		document.getElementById("pointsAvailable").innerHTML = "Points Available: " + pointsVar;
	}
	--floorTime;
	if(floorTime == 0) {
		++floor;
		document.getElementById("floorNum").innerHTML = "FloorNumber: " + floor;
		floorTime = 600;
	}
}
function mainFunction() {
	gameTimer = setInterval(runPhase, 100);
}
</script>
</body>
</html>